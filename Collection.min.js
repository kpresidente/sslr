const insertCollections=async e=>{try{Knack.showSpinner();const t=e.scene.views.find((e=>"Foreign Costs"==e.name)),o=t.source.object,s=t.source.connection_key,i=e.scene.scene_id,n=e.scene.views.find((e=>"Select Collections"==e.name)),l=getChecked(n).map((e=>db(TBL.CollectionCosts).filter(FLD.CollectionCosts.Collection,"is",e).filter(FLD.CollectionCosts.Exists,"is",1).get())),c=await Promise.allSettled(l),a=c.filter((e=>"fulfilled"==e.status)).flatMap((e=>e.value.data)),r=await a.map((e=>db(o).create({[s]:i,[FLD[o].Category]:sub(e,FLD.CollectionCosts.Category,"id"),[FLD[o].Metal]:sub(e,FLD.CollectionCosts.Metal,"id"),[FLD[o].CostItem]:sub(e,FLD.CollectionCosts.CostItem,"id"),[FLD[o].CostUnit]:sub(e,FLD.CollectionCosts.CostUnit,"id"),[FLD[o].UnitPrice]:e[FLD.CollectionCosts.UnitPrice]}))),C=(await Promise.allSettled(r)).concat(c).filter((e=>"rejected"==e.status)).map((e=>e.reason.toString())).join("<br>");if(C.length)throw new Error(C);document.getElementsByClassName("close-modal")[0]?.click(),Knack.router.scene_view.model.views.models.map((e=>Knack.views[e.id].model)).filter((e=>"data"in e)).forEach((e=>e.fetch())),Knack.hideSpinner()}catch(e){MsgBox("There was an error adding the collection costs!",`${e.name}, ${e.message}`)}};