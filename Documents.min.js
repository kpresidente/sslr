async function getBase64(e){return new Promise(((t,r)=>{var a=new window.FileReader;a.readAsDataURL(e),a.onloadend=()=>t(a.result),a.onerror=()=>r(error)}))}async function getBlob(e){e.startsWith("data")||(e=`data:image/jpeg;base64,${e}`);return await fetch(e).blob()}var doc=e=>{const t={accessToken:"bYsAjnjg6cQAAAAAAAA4iN2lniNH91qM_98WNh8_iTuT8L9gZT_u-oApgv4GlBcs"};return{create:async function(){try{Knack.showSpinner();const e=await r(),n=await a(e.TemplatePath,e),o=new window.Dropbox.Dropbox(t);return reponse=await o.filesUpload({contents:n,path:e.FilePath,mode:"overwrite"}),response=await MsgBox("The PDF was created successfully!"),response}catch(e){return await MsgBox("There was an error creating the PDF!",e),e}},rename:async function(r,a){try{Knack.showSpinner();const n=e.source.object,o=r[FLD[n].FilePath].replace("www.dropbox.com/home",""),i=a[FLD[n].FilePath].replace("www.dropbox.com/home","");if(o==i)return"The document path was not changed.";const s=new window.Dropbox.Dropbox(t);return response=await s.filesMove({from_path:i,to_path:o,autorename:!0}),Knack.hideSpinner(),response}catch(e){return await MsgBox("There was an error renaming the PDF!",e),e}},delete:async function(r){try{Knack.showSpinner();const a=e.source.object,n=r[FLD[a].FilePath].replace("www.dropbox.com/home",""),o=new window.Dropbox.Dropbox(t);return response=await o.filesDelete({path:n}),Knack.hideSpinner(),response}catch(e){return await MsgBox("There was an error deleting the PDF!",e),e}},fields:async function(e){let t=await fetch(e),r=await t.arrayBuffer();return pdfform().list_fields(r)},preview:async function(e){try{Knack.showSpinner(),URL.revokeObjectURL(e);const t=await r(),n=await a(t.TemplatePath,t);return URL.createObjectURL(n)}catch(e){return await MsgBox("There was an error getting the PDF Preview!",e),e}finally{Knack.hideSpinner()}}};async function r(){let t=e.scene.views.flatMap((e=>{let t=dv(e).getDisplayed();return t=dv(e).stripHTML(t),t=t.flatMap(((t,r)=>{let a=Object.entries(t).filter((([e,t])=>!!t));return"table"==e.type&&(a=a.map((([e,t])=>[`${e}${r}`,t]))),a})),t}));return Object.fromEntries(t)}async function a(e,t){t=Object.entries(t).map((([e,t])=>[e,[t]])),t=Object.fromEntries(t);let r=await fetch(e),a=await r.arrayBuffer(),n=pdfform().transform(a,t);return new Blob([n],{type:"application/pdf"})}};